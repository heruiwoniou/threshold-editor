!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("backbone"),require("underscore")):"function"==typeof define&&define.amd?define(["backbone","underscore"],t):e.ThresholdEditor=t(e.Backbone,e._)}(this,function(e,t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var n=Array.isArray,r=Object.prototype.toString,o=n||function(e){return"[object Array]"===r.call(e)};var i="2",s=function(e){return e&&"VirtualNode"===e.type&&e.version===i};var a=function(e){return e&&"Widget"===e.type};var l=function(e){return e&&"Thunk"===e.type};var u=function(e){return e&&("function"==typeof e.hook&&!e.hasOwnProperty("hook")||"function"==typeof e.unhook&&!e.hasOwnProperty("unhook"))};var c=p,h={},d=[];function p(e,t,n,r,o){this.tagName=e,this.properties=t||h,this.children=n||d,this.key=null!=r?String(r):void 0,this.namespace="string"==typeof o?o:null;var i,c=n&&n.length||0,p=0,f=!1,v=!1,m=!1;for(var g in t)if(t.hasOwnProperty(g)){var y=t[g];u(y)&&y.unhook&&(i||(i={}),i[g]=y)}for(var N=0;N<c;N++){var _=n[N];s(_)?(p+=_.count||0,!f&&_.hasWidgets&&(f=!0),!v&&_.hasThunks&&(v=!0),m||!_.hooks&&!_.descendantHooks||(m=!0)):!f&&a(_)?"function"==typeof _.destroy&&(f=!0):!v&&l(_)&&(v=!0)}this.count=c+p,this.hasWidgets=f,this.hasThunks=v,this.hooks=i,this.descendantHooks=m}p.prototype.version=i,p.prototype.type="VirtualNode";var f=v;function v(e){this.text=String(e)}v.prototype.version=i,v.prototype.type="VirtualText";var m=function(e){return e&&"VirtualText"===e.type&&e.version===i};var g,y,N,_=(y=String.prototype.split,N=/()??/.exec("")[1]===g,function(e,t,n){if("[object RegExp]"!==Object.prototype.toString.call(t))return y.call(e,t,n);var r,o,i,s,a=[],l=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.extended?"x":"")+(t.sticky?"y":""),u=0;for(t=new RegExp(t.source,l+"g"),e+="",N||(r=new RegExp("^"+t.source+"$(?!\\s)",l)),n=n===g?-1>>>0:n>>>0;(o=t.exec(e))&&!((i=o.index+o[0].length)>u&&(a.push(e.slice(u,o.index)),!N&&o.length>1&&o[0].replace(r,function(){for(var e=1;e<arguments.length-2;e++)arguments[e]===g&&(o[e]=g)}),o.length>1&&o.index<e.length&&Array.prototype.push.apply(a,o.slice(1)),s=o[0].length,u=i,a.length>=n));)t.lastIndex===o.index&&t.lastIndex++;return u===e.length?!s&&t.test("")||a.push(""):a.push(e.slice(u)),a.length>n?a.slice(0,n):a}),b=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,w=/^\.|#/,k=function(e,t){if(!e)return"DIV";var n,r,o,i,s=!t.hasOwnProperty("id"),a=_(e,b),l=null;w.test(a[1])&&(l="DIV");for(i=0;i<a.length;i++)(r=a[i])&&(o=r.charAt(0),l?"."===o?(n=n||[]).push(r.substring(1,r.length)):"#"===o&&s&&(t.id=r.substring(1,r.length)):l=r);n&&(t.className&&n.push(t.className),t.className=n.join(" "));return t.namespace?l:l.toUpperCase()};var E=x;function x(e){if(!(this instanceof x))return new x(e);this.value=e}x.prototype.hook=function(e,t){e[t]!==this.value&&(e[t]=this.value)};var T="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},O="undefined"!=typeof window?window:void 0!==T?T:{},C=function(e,t){if(e in O)return O[e];return O[e]=t,t};(function(e,t,n){var r="__INDIVIDUAL_ONE_VERSION_"+e,o=C(r+"_ENFORCE_SINGLETON",t);if(o!==t)throw new Error("Can only have one copy of "+e+".\nYou already have version "+o+" installed.\nThis means you cannot install version "+t);C(r,n)})("ev-store","7");var S="__EV_STORE_KEY@7",j=function(e){var t=e[S];t||(t=e[S]={});return t};var A=I;function I(e){if(!(this instanceof I))return new I(e);this.value=e}function R(e){return s(e)||m(e)||a(e)||l(e)}function V(e){try{return JSON.stringify(e,null,"    ")}catch(t){return String(e)}}I.prototype.hook=function(e,t){j(e)[t.substr(3)]=this.value},I.prototype.unhook=function(e,t){j(e)[t.substr(3)]=void 0};var D=function(e,t,n){var r,i,s,a,l=[];!n&&(h=t,"string"==typeof h||o(h)||R(h))&&(n=t,i={});var h;r=k(e,i=i||t||{}),i.hasOwnProperty("key")&&(s=i.key,i.key=void 0);i.hasOwnProperty("namespace")&&(a=i.namespace,i.namespace=void 0);"INPUT"!==r||a||!i.hasOwnProperty("value")||void 0===i.value||u(i.value)||(i.value=E(i.value));(function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];if(u(n))continue;"ev-"===t.substr(0,3)&&(e[t]=A(n))}})(i),void 0!==n&&null!==n&&function e(t,n,r,i){if("string"==typeof t)n.push(new f(t));else if("number"==typeof t)n.push(new f(String(t)));else if(R(t))n.push(t);else{if(!o(t)){if(null===t||void 0===t)return;throw a={foreignObject:t,parentVnode:{tagName:r,properties:i}},(l=new Error).type="virtual-hyperscript.unexpected.virtual-element",l.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+V(a.foreignObject)+".\nThe parent vnode is:\n"+V(a.parentVnode),l.foreignObject=a.foreignObject,l.parentVnode=a.parentVnode,l}for(var s=0;s<t.length;s++)e(t[s],n,r,i)}var a,l}(n,l,r,i);return new c(r,i,l,s,a)},P=Array.prototype.slice,F=function(e,t){"length"in e||(e=[e]);e=P.call(e);for(;e.length;){var n=e.shift(),r=t(n);if(r)return r;n.childNodes&&n.childNodes.length&&(e=P.call(n.childNodes).concat(e))}};var L=U;function U(e,t){if(!(this instanceof U))return new U(e,t);this.data=e,this.nodeValue=e,this.length=e.length,this.ownerDocument=t||null}U.prototype.nodeType=8,U.prototype.nodeName="#comment",U.prototype.toString=function(){return"[object Comment]"};var M=B;function B(e,t){if(!(this instanceof B))return new B(e);this.data=e||"",this.length=this.data.length,this.ownerDocument=t||null}B.prototype.type="DOMTextNode",B.prototype.nodeType=3,B.prototype.nodeName="#text",B.prototype.toString=function(){return this.data},B.prototype.replaceData=function(e,t,n){var r=this.data,o=r.substring(0,e),i=r.substring(e+t,r.length);this.data=o+n+i,this.length=this.data.length};var H=function(e){var t=this,n=e.type;e.target||(e.target=t);t.listeners||(t.listeners={});var r=t.listeners[n];if(r)return r.forEach(function(n){e.currentTarget=t,"function"==typeof n?n(e):n.handleEvent(e)});t.parentNode&&t.parentNode.dispatchEvent(e)};var W=function(e,t){this.listeners||(this.listeners={});this.listeners[e]||(this.listeners[e]=[]);-1===this.listeners[e].indexOf(t)&&this.listeners[e].push(t)};var z=function(e,t){if(!this.listeners)return;if(!this.listeners[e])return;var n=this.listeners[e],r=n.indexOf(t);-1!==r&&n.splice(r,1)};var G=q,K=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function q(e){switch(e.nodeType){case 3:return Z(e.data);case 8:return"\x3c!--"+e.data+"--\x3e";default:return function(e){var t=[],n=e.tagName;"http://www.w3.org/1999/xhtml"===e.namespaceURI&&(n=n.toLowerCase());t.push("<"+n+function(e){var t=[];for(var n in e)X(e,n)&&t.push({name:n,value:e[n]});for(var r in e._attributes)for(var o in e._attributes[r]){var i=e._attributes[r][o],s=(i.prefix?i.prefix+":":"")+o;t.push({name:s,value:i.value})}return e.className&&t.push({name:"class",value:e.className}),t.length?Y(t):""}(e)+function(e){var t=e.dataset,n=[];for(var r in t)n.push({name:"data-"+r,value:t[r]});return n.length?Y(n):""}(e)),K.indexOf(n)>-1?t.push(" />"):(t.push(">"),e.childNodes.length?t.push.apply(t,e.childNodes.map(q)):e.textContent||e.innerText?t.push(Z(e.textContent||e.innerText)):e.innerHTML&&t.push(e.innerHTML),t.push("</"+n+">"));return t.join("")}(e)}}function X(e,t){var n=typeof e[t];return"style"===t&&Object.keys(e.style).length>0||e.hasOwnProperty(t)&&("string"===n||"boolean"===n||"number"===n)&&"nodeName"!==t&&"className"!==t&&"tagName"!==t&&"textContent"!==t&&"innerText"!==t&&"namespaceURI"!==t&&"innerHTML"!==t}function Y(e){var t=[];return e.forEach(function(e){var n=e.name,r=e.value;"style"===n&&(r=function(e){if("string"==typeof e)return e;var t="";return Object.keys(e).forEach(function(n){var r=e[n];n=n.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),t+=n+":"+r+";"}),t}(r)),t.push(n+'="'+Z(r).replace(/"/g,"&quot;")+'"')}),t.length?" "+t.join(" "):""}function Z(e){var t="";return"string"==typeof e?t=e:e&&(t=e.toString()),t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var J="http://www.w3.org/1999/xhtml",Q=ee;function ee(e,t,n){if(!(this instanceof ee))return new ee(e);var r=void 0===n?J:n||null;this.tagName=r===J?String(e).toUpperCase():e,this.nodeName=this.tagName,this.className="",this.dataset={},this.childNodes=[],this.parentNode=null,this.style={},this.ownerDocument=t||null,this.namespaceURI=r,this._attributes={},"INPUT"===this.tagName&&(this.type="text")}ee.prototype.type="DOMElement",ee.prototype.nodeType=1,ee.prototype.appendChild=function(e){return e.parentNode&&e.parentNode.removeChild(e),this.childNodes.push(e),e.parentNode=this,e},ee.prototype.replaceChild=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var n=this.childNodes.indexOf(t);return t.parentNode=null,this.childNodes[n]=e,e.parentNode=this,t},ee.prototype.removeChild=function(e){var t=this.childNodes.indexOf(e);return this.childNodes.splice(t,1),e.parentNode=null,e},ee.prototype.insertBefore=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var n=null===t||void 0===t?-1:this.childNodes.indexOf(t);return n>-1?this.childNodes.splice(n,0,e):this.childNodes.push(e),e.parentNode=this,e},ee.prototype.setAttributeNS=function(e,t,n){var r=null,o=t,i=t.indexOf(":");(i>-1&&(r=t.substr(0,i),o=t.substr(i+1)),"INPUT"===this.tagName&&"type"===t)?this.type=n:(this._attributes[e]||(this._attributes[e]={}))[o]={value:n,prefix:r}},ee.prototype.getAttributeNS=function(e,t){var n=this._attributes[e],r=n&&n[t]&&n[t].value;return"INPUT"===this.tagName&&"type"===t?this.type:"string"!=typeof r?null:r},ee.prototype.removeAttributeNS=function(e,t){var n=this._attributes[e];n&&delete n[t]},ee.prototype.hasAttributeNS=function(e,t){var n=this._attributes[e];return!!n&&t in n},ee.prototype.setAttribute=function(e,t){return this.setAttributeNS(null,e,t)},ee.prototype.getAttribute=function(e){return this.getAttributeNS(null,e)},ee.prototype.removeAttribute=function(e){return this.removeAttributeNS(null,e)},ee.prototype.hasAttribute=function(e){return this.hasAttributeNS(null,e)},ee.prototype.removeEventListener=z,ee.prototype.addEventListener=W,ee.prototype.dispatchEvent=H,ee.prototype.focus=function(){},ee.prototype.toString=function(){return G(this)},ee.prototype.getElementsByClassName=function(e){var t=e.split(" "),n=[];return F(this,function(e){if(1===e.nodeType){var r=(e.className||"").split(" ");t.every(function(e){return-1!==r.indexOf(e)})&&n.push(e)}}),n},ee.prototype.getElementsByTagName=function(e){e=e.toLowerCase();var t=[];return F(this.childNodes,function(n){1!==n.nodeType||"*"!==e&&n.tagName.toLowerCase()!==e||t.push(n)}),t},ee.prototype.contains=function(e){return F(this,function(t){return e===t})||!1};var te=ne;function ne(e){if(!(this instanceof ne))return new ne;this.childNodes=[],this.parentNode=null,this.ownerDocument=e||null}ne.prototype.type="DocumentFragment",ne.prototype.nodeType=11,ne.prototype.nodeName="#document-fragment",ne.prototype.appendChild=Q.prototype.appendChild,ne.prototype.replaceChild=Q.prototype.replaceChild,ne.prototype.removeChild=Q.prototype.removeChild,ne.prototype.toString=function(){return this.childNodes.map(function(e){return String(e)}).join("")};var re=oe;function oe(e){}oe.prototype.initEvent=function(e,t,n){this.type=e,this.bubbles=t,this.cancelable=n},oe.prototype.preventDefault=function(){};var ie=se;function se(){if(!(this instanceof se))return new se;this.head=this.createElement("head"),this.body=this.createElement("body"),this.documentElement=this.createElement("html"),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body),this.childNodes=[this.documentElement],this.nodeType=9}var ae=se.prototype;ae.createTextNode=function(e){return new M(e,this)},ae.createElementNS=function(e,t){var n=null===e?null:String(e);return new Q(t,this,n)},ae.createElement=function(e){return new Q(e,this)},ae.createDocumentFragment=function(){return new te(this)},ae.createEvent=function(e){return new re(e)},ae.createComment=function(e){return new L(e,this)},ae.getElementById=function(e){return e=String(e),F(this.childNodes,function(t){if(String(t.id)===e)return t})||null},ae.getElementsByClassName=Q.prototype.getElementsByClassName,ae.getElementsByTagName=Q.prototype.getElementsByTagName,ae.contains=Q.prototype.contains,ae.removeEventListener=z,ae.addEventListener=W,ae.dispatchEvent=H;var le,ue=new ie,ce=void 0!==T?T:"undefined"!=typeof window?window:{};"undefined"!=typeof document?le=document:(le=ce["__GLOBAL_DOCUMENT_CACHE@4"])||(le=ce["__GLOBAL_DOCUMENT_CACHE@4"]=ue);var he=le,de=function(e){return"object"==typeof e&&null!==e},pe=function(e,t,n){for(var r in t){var o=t[r];void 0===o?fe(e,r,o,n):u(o)?(fe(e,r,o,n),o.hook&&o.hook(e,r,n?n[r]:void 0)):de(o)?ve(e,t,n,r,o):e[r]=o}};function fe(e,t,n,r){if(r){var o=r[t];if(u(o))o.unhook&&o.unhook(e,t,n);else if("attributes"===t)for(var i in o)e.removeAttribute(i);else if("style"===t)for(var s in o)e.style[s]="";else e[t]="string"==typeof o?"":null}}function ve(e,t,n,r,o){var i=n?n[r]:void 0;if("attributes"!==r)if(i&&de(i)&&me(i)!==me(o))e[r]=o;else{de(e[r])||(e[r]={});var s="style"===r?"":void 0;for(var a in o){var l=o[a];e[r][a]=void 0===l?s:l}}else for(var u in o){var c=o[u];void 0===c?e.removeAttribute(u):e.setAttribute(u,c)}}function me(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}var ge=function(e,t){var n=e,r=t;l(t)&&(r=ye(t,e));l(e)&&(n=ye(e,null));return{a:n,b:r}};function ye(e,t){var n=e.vnode;if(n||(n=e.vnode=e.render(t)),!(s(n)||m(n)||a(n)))throw new Error("thunk did not return a valid node");return n}var Ne=function e(t,n){var r=n&&n.document||he;var o=n?n.warn:null;t=ge(t).a;if(a(t))return t.init();if(m(t))return r.createTextNode(t.text);if(!s(t))return o&&o("Item is not a valid virtual dom node",t),null;var i=null===t.namespace?r.createElement(t.tagName):r.createElementNS(t.namespace,t.tagName);var l=t.properties;pe(i,l);var u=t.children;for(var c=0;c<u.length;c++){var h=e(u[c],n);h&&i.appendChild(h)}return i};var _e=Ne;we.NONE=0,we.VTEXT=1,we.VNODE=2,we.WIDGET=3,we.PROPS=4,we.ORDER=5,we.INSERT=6,we.REMOVE=7,we.THUNK=8;var be=we;function we(e,t,n){this.type=Number(e),this.vNode=t,this.patch=n}we.prototype.version=i,we.prototype.type="VirtualPatch";var ke=function e(t,n){var r;for(var o in t){o in n||((r=r||{})[o]=void 0);var i=t[o],s=n[o];if(i!==s)if(de(i)&&de(s))if(Ee(s)!==Ee(i))(r=r||{})[o]=s;else if(u(s))(r=r||{})[o]=s;else{var a=e(i,s);a&&((r=r||{})[o]=a)}else(r=r||{})[o]=s}for(var l in n)l in t||((r=r||{})[l]=n[l]);return r};function Ee(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}function xe(e,t){var n={a:e};return Te(e,t,n,0),n}function Te(e,t,n,r){if(e!==t){var o=n[r],i=!1;if(l(e)||l(t))Ce(e,t,n,r);else if(null==t)a(e)||(Oe(e,n,r),o=n[r]),o=Ae(o,new be(be.REMOVE,e,t));else if(s(t))if(s(e))if(e.tagName===t.tagName&&e.namespace===t.namespace&&e.key===t.key){var u=ke(e.properties,t.properties);u&&(o=Ae(o,new be(be.PROPS,e,u))),o=function(e,t,n,r,o){for(var i=e.children,a=function(e,t){var n=je(t),r=n.keys,o=n.free;if(o.length===t.length)return{children:t,moves:null};var i=je(e),s=i.keys;if(i.free.length===e.length)return{children:t,moves:null};for(var a=[],l=0,u=o.length,c=0,h=0;h<e.length;h++){var d,p=e[h];p.key?r.hasOwnProperty(p.key)?(d=r[p.key],a.push(t[d])):(d=h-c++,a.push(null)):l<u?(d=o[l++],a.push(t[d])):(d=h-c++,a.push(null))}for(var f=l>=o.length?t.length:o[l],v=0;v<t.length;v++){var m=t[v];m.key?s.hasOwnProperty(m.key)||a.push(m):v>=f&&a.push(m)}for(var g,y=a.slice(),N=0,_=[],b=[],w=0;w<t.length;){var k=t[w];for(g=y[N];null===g&&y.length;)_.push(Se(y,N,null)),g=y[N];g&&g.key===k.key?(N++,w++):k.key?(g&&g.key&&r[g.key]!==w+1?(_.push(Se(y,N,g.key)),(g=y[N])&&g.key===k.key?N++:b.push({key:k.key,to:w})):b.push({key:k.key,to:w}),w++):g&&g.key&&_.push(Se(y,N,g.key))}for(;N<y.length;)g=y[N],_.push(Se(y,N,g&&g.key));if(_.length===c&&!b.length)return{children:a,moves:null};return{children:a,moves:{removes:_,inserts:b}}}(i,t.children),l=a.children,u=i.length,c=l.length,h=u>c?u:c,d=0;d<h;d++){var p=i[d],f=l[d];o+=1,p?Te(p,f,n,o):f&&(r=Ae(r,new be(be.INSERT,null,f))),s(p)&&p.count&&(o+=p.count)}a.moves&&(r=Ae(r,new be(be.ORDER,e,a.moves)));return r}(e,t,n,o,r)}else o=Ae(o,new be(be.VNODE,e,t)),i=!0;else o=Ae(o,new be(be.VNODE,e,t)),i=!0;else m(t)?m(e)?e.text!==t.text&&(o=Ae(o,new be(be.VTEXT,e,t))):(o=Ae(o,new be(be.VTEXT,e,t)),i=!0):a(t)&&(a(e)||(i=!0),o=Ae(o,new be(be.WIDGET,e,t)));o&&(n[r]=o),i&&Oe(e,n,r)}}function Oe(e,t,n){!function e(t,n,r){if(s(t)){if(t.hooks&&(n[r]=Ae(n[r],new be(be.PROPS,t,function(e){var t={};for(var n in e)t[n]=void 0;return t}(t.hooks)))),t.descendantHooks||t.hasThunks)for(var o=t.children,i=o.length,a=0;a<i;a++){var u=o[a];e(u,n,r+=1),s(u)&&u.count&&(r+=u.count)}}else l(t)&&Ce(t,null,n,r)}(e,t,n),function e(t,n,r){if(a(t))"function"==typeof t.destroy&&(n[r]=Ae(n[r],new be(be.REMOVE,t,null)));else if(s(t)&&(t.hasWidgets||t.hasThunks))for(var o=t.children,i=o.length,u=0;u<i;u++){var c=o[u];e(c,n,r+=1),s(c)&&c.count&&(r+=c.count)}else l(t)&&Ce(t,null,n,r)}(e,t,n)}function Ce(e,t,n,r){var o=ge(e,t),i=xe(o.a,o.b);(function(e){for(var t in e)if("a"!==t)return!0;return!1})(i)&&(n[r]=new be(be.THUNK,null,i))}function Se(e,t,n){return e.splice(t,1),{from:t,key:n}}function je(e){for(var t={},n=[],r=e.length,o=0;o<r;o++){var i=e[o];i.key?t[i.key]=o:n.push(o)}return{keys:t,free:n}}function Ae(e,t){return e?(o(e)?e.push(t):e=[e,t],e):t}var Ie=xe,Re={},Ve=function(e,t,n,r){return n&&0!==n.length?(n.sort(Pe),function e(t,n,r,o,i){o=o||{};if(t){De(r,i,i)&&(o[i]=t);var s=n.children;if(s)for(var a=t.childNodes,l=0;l<n.children.length;l++){i+=1;var u=s[l]||Re,c=i+(u.count||0);De(r,i,c)&&e(a[l],u,r,o,i),i=c}}return o}(e,t,n,r,0)):{}};function De(e,t,n){if(0===e.length)return!1;for(var r,o,i=0,s=e.length-1;i<=s;){if(o=e[r=(s+i)/2>>0],i===s)return o>=t&&o<=n;if(o<t)i=r+1;else{if(!(o>n))return!0;s=r-1}}return!1}function Pe(e,t){return e>t?1:-1}var Fe=function(e,t){if(a(e)&&a(t))return"name"in e&&"name"in t?e.id===t.id:e.init===t.init;return!1};var Le=function(e,t,n){var r=e.type,o=e.vNode,i=e.patch;switch(r){case be.REMOVE:return function(e,t){var n=e.parentNode;n&&n.removeChild(e);return Ue(e,t),null}(t,o);case be.INSERT:return function(e,t,n){var r=n.render(t,n);e&&e.appendChild(r);return e}(t,i,n);case be.VTEXT:return function(e,t,n,r){var o;if(3===e.nodeType)e.replaceData(0,e.length,n.text),o=e;else{var i=e.parentNode;o=r.render(n,r),i&&o!==e&&i.replaceChild(o,e)}return o}(t,0,i,n);case be.WIDGET:return function(e,t,n,r){var o,i=Fe(t,n);o=i?n.update(t,e)||e:r.render(n,r);var s=e.parentNode;s&&o!==e&&s.replaceChild(o,e);i||Ue(e,t);return o}(t,o,i,n);case be.VNODE:return function(e,t,n,r){var o=e.parentNode,i=r.render(n,r);o&&i!==e&&o.replaceChild(i,e);return i}(t,0,i,n);case be.ORDER:return function(e,t){for(var n,r,o,i=e.childNodes,s={},a=0;a<t.removes.length;a++)r=t.removes[a],n=i[r.from],r.key&&(s[r.key]=n),e.removeChild(n);for(var l=i.length,u=0;u<t.inserts.length;u++)o=t.inserts[u],n=s[o.key],e.insertBefore(n,o.to>=l++?null:i[o.to])}(t,i),t;case be.PROPS:return pe(t,i,o.properties),t;case be.THUNK:return function(e,t){e&&t&&e!==t&&e.parentNode&&e.parentNode.replaceChild(t,e);return t}(t,n.patch(t,i,n));default:return t}};function Ue(e,t){"function"==typeof t.destroy&&a(t)&&t.destroy(e)}function Me(e,t,n){var r=function(e){var t=[];for(var n in e)"a"!==n&&t.push(Number(n));return t}(t);if(0===r.length)return e;var o=Ve(e,t.a,r),i=e.ownerDocument;n.document||i===he||(n.document=i);for(var s=0;s<r.length;s++){var a=r[s];e=Be(e,o[a],t[a],n)}return e}function Be(e,t,n,r){if(!t)return e;var i;if(o(n))for(var s=0;s<n.length;s++)i=Le(n[s],t,r),t===e&&(e=i);else i=Le(n,t,r),t===e&&(e=i);return e}var He=function e(t,n,r){r=r||{};r.patch=r.patch&&r.patch!==e?r.patch:Me;r.render=r.render||Ne;return r.patch(t,n,r)},We=e.View.extend({tree:null,treeNode:null,timer:null,components:{},tpl:function(){},initializeRender:function(){return this.tree=this.tpl(this),this.treeNode=_e(this.tree),this.updateRender},updateRender:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout(function(){var t=e.tpl(e),n=Ie(e.tree,t);e.treeNode=He(e.treeNode,n),e.tree=t},0)},triggerRender:function(){this.triggerRender=this.initializeRender(),this.$el.replaceWith(this.treeNode)},render:function(){this.triggerRender()}}),ze=/^([\d\.]*)\s*([\d\.]*)\s*([\d\.]*)$/,Ge=/\((\d{2}:\d{2}\s*\d{2}:\d{2})\)\s*([><=])\s*(\d*\s*\d*\s*\d*)|(\s*)([><=])\s*(\d*\s*\d*\s*\d*)/,Ke=function(e){var t=Ge.exec(e),n=(t[1]||t[4]).split(" "),r=t[2]||t[5],o=t[3]||t[6];return new $e({from:2==n.length?n[0]:"",to:2==n.length?n[1]:"",operator:r,threshold:o})},$e=e.Model.extend({defaults:{from:"",to:"",operator:">",threshold:"",editing:!1},getIsAcrossTheDay:function(){return~~this.get("from").split(":")[0]>~~this.get("to").split(":")[0]},getFrom:function(){return this.get("from").split(":")[0]},getTo:function(){return this.get("to").split(":")[0]},getThreshold:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;return ze.exec(this.get("threshold")).slice(1,1+e)},setFirst:function(e){var n=ze.exec(this.get("threshold"));n=n.slice(1,4),t.each(n,function(t,r){r<1&&""===t&&(n[r]=e)}),n[0]=e,this.set("threshold",n.join(" "))},setSecond:function(e){var n=ze.exec(this.get("threshold"));n=n.slice(1,4),t.each(n,function(t,r){r<1&&""===t&&(n[r]=e)}),n[1]=e,this.set("threshold",n.join(" "))},setThree:function(e){var n=ze.exec(this.get("threshold"));n=n.slice(1,4),t.each(n,function(t,r){r<2&&""===t&&(n[r]=e)}),n[2]=e,this.set("threshold",n.join(" "))},isallday:function(){return""===this.getFrom()&&""===this.getTo()}});function qe(e){return function(t){var n=t.components,r=t.instanceName,o=t.props,i=t.state,s=t.parentState,a=null;if(!(a=n[r])){for(var l=arguments.length,u=Array(l>1?l-1:0),c=1;c<l;c++)u[c-1]=arguments[c];a=n[r]=new(Function.prototype.bind.apply(e,[null].concat([t],u)))}return a.tpl(o||{},i||{},s)}}var Xe,Ye,Ze=["purple","light-blue","green","blue","magenta","bright-green"];Xe=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e},Ye=function(e){var t,n,r=document.createTextNode(""),o=0;return new e(function(){var e;if(t)n&&(t=n.concat(t));else{if(!n)return;t=n}if(n=t,t=null,"function"==typeof n)return e=n,n=null,void e();for(r.data=o=++o%2;n;)e=n.shift(),n.length||(n=null),e()}).observe(r,{characterData:!0}),function(e){Xe(e),t?"function"==typeof t?t=[t,e]:t.push(e):(t=e,r.data=o=++o%2)}};var Je=function(){if("object"==typeof process&&process&&"function"==typeof process.nextTick)return process.nextTick;if("object"==typeof document&&document){if("function"==typeof MutationObserver)return Ye(MutationObserver);if("function"==typeof WebKitMutationObserver)return Ye(WebKitMutationObserver)}return"function"==typeof setImmediate?function(e){setImmediate(Xe(e))}:"function"==typeof setTimeout||"object"==typeof setTimeout?function(e){setTimeout(Xe(e),0)}:null}();function Qe(e){if(!(this instanceof Qe))return new Qe(e);this.value=e}Qe.prototype.hook=function(e){var t=this;Je(function(){e.value=t.value})},Qe.prototype.unhook=function(e){e.value=""},Qe.prototype.type="AsyncValHook";var et=qe(We.extend({tpl:function(e,n,r){var o=this,i=this.model.isallday();return D("span",null,[D("div",{className:"threshold-editor__col-2 threshold-editor__list--occupy-container"},[D("div",{className:i?"threshold-editor__list--occupy is-allday":"threshold-editor__list--occupy"},[D("div",{className:"threshold-editor__row"},[D("div",{className:i?"threshold-editor__col-10 threshold-editor__list--padding":"threshold-editor__col-5 threshold-editor__list--padding"},[D("select",{value:Qe(this.model.getFrom()),onchange:function(e){return r.fromChange(o.model,o.model.getFrom(),e.target.value)}},[t.range(24).map(function(e,t){var n=t.toString().length>=2?t.toString():"0"+t,r="00:00".replace(/00/,n);return D("option",{value:n},[" ",r," "])}),D("option",{value:""},[" all day "])])]),i?"":D("div",{className:"threshold-editor__col-5 threshold-editor__list--padding"},[D("select",{onchange:function(e){return r.toChange(o.model,e.target.value)}},[t.range(24).map(function(e,t){var n=t.toString().length>=2?t.toString():"0"+t,r="00:00".replace(/00/,n);return D("option",{value:n},[" ",r," "])})])])])])])])}})),tt=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),nt=qe(We.extend({tpl:function(e,t,n){var r=this;return D("span",null,[D("div",{className:"threshold-editor__col-2 threshold-editor__list--padding"},[D("b",null,["when the ErrorSystem"])]),D("div",{className:"threshold-editor__col-1 threshold-editor__list--padding"},[D("select",null,[D("option",{value:"value"},["value"]),D("option",{value:"delta"},["delta"])])]),D("div",{className:"threshold-editor__col-2 threshold-editor__list--padding"},[D("select",null,[[[">","is greater than (>)"],["<","is less than (<)"],["=","is equa l to (=)"]].map(function(e){var t=tt(e,2),n=t[0],o=t[1];return D("option",{value:n,selected:n===r.model.get("operator")},[o])})])])])}})),rt=[{className:"threshold-editor__note threshold-editor__note--warn",text:"trigger a warning"},{className:"threshold-editor__note threshold-editor__note--error",text:"trigger an error"},{className:"threshold-editor__note threshold-editor__note--critical",text:"trigger a critical"}],ot=qe(We.extend({tpl:function(e,n,r){var o=this,i=this.model.getThreshold(),s=t.filter(i,function(e){return!!e}).length,a=n.selected?i.slice(0,3):i.slice(0,0==s?1:s);return D("span",null,[D("div",{className:"threshold-editor__col-3 threshold-editor__list--padding"},[a.map(function(e,t){return D("div",{className:"threshold-editor__threshold-container"},[D("div",{className:"threshold-editor__threshold__value"},[D("input",{type:"number",value:a[t],onchange:function(e){var n=e.target.value;return r.thresholdChange(o.model,t,n)}})]),D("div",{className:"threshold-editor__threshold__tip"},[D("span",{className:rt[t].className},[rt[t].text,D("i")])])])})])])}})),it=qe(We.extend({tpl:function(e,t,n){var r=this;return D("div",{className:t.selected?"threshold-editor__single-rules threshold-editor__single-rules--active":"threshold-editor__single-rules"},[D("div",{className:"threshold-editor__trigger--itemclick",onclick:function(){return n.itemClick(r.model)}},[D("span",{className:"threshold-editor__color-tab "+Ze[t.index%Ze.length]}),D("div",{className:"threshold-editor__row threshold-editor__list"},[et(Object.assign({},{state:t,parentState:n,model:this.model,components:n.components,instanceName:"component-time-"+this.cid})),nt(Object.assign({},{state:t,parentState:n,model:this.model,components:n.components,instanceName:"component-comparison-"+this.cid})),ot(Object.assign({},{state:t,parentState:n,model:this.model,components:n.components,instanceName:"component-alert-"+this.cid}))])]),t.selected?D("a",{href:"javascript:;",className:"threshold-editor__delete",onclick:function(){return n.removeItem(r.model,t.index)}}):""])}})),st=qe(We.extend({tpl:function(e,n,r){var o=this,i=[];return this.collection.sortBy(function(e){var t=e.getFrom();return t=""===t?24:~~t}).forEach(function(e,t){i[o.collection.length-1-t]=e}),D("div",{className:"threshold-editor__timeline",style:{display:0==i.length?"none":"block"}},[D("div",{className:"threshold-editor__time-panel"},[t.range(12).map(function(e){return D("span",null,[2+2*e+":00","  "])})]),D("div",{className:"threshold-editor__timebar-container"},[t.map(i,function(e,t){var n=e.isallday(),r=100*~~e.getFrom()/24+"%",o=100*(24-~~e.getTo())/24+"%",s=e.get("editing"),a=s?i.length:t,l=n?{width:"100%"}:{left:r,right:o};return l.zIndex=a,e.getIsAcrossTheDay()?D("div",{className:"threshold-editor__timebar is-across-the-day "+Ze[(i.length-1-t)%Ze.length]+(s?" is-editing":""),style:{zIndex:a},id:i.length-1-t%Ze.length},[D("div",{className:"threshold-editor__timebar__child",style:{left:0,right:o}}),D("div",{className:"threshold-editor__timebar__child",style:{right:0,left:r}})]):D("div",{className:"threshold-editor__timebar "+Ze[(i.length-1-t)%Ze.length]+(n?" is-allday":"")+(s?" is-editing":""),style:l})})])])}})),at=!1,lt=We.extend({initialize:function(){var e=this;$(document).on("click",function(t){at||e.collection.forEach(function(e){return e.set("editing",!1)}),at=!1}),this.listenTo(this.model,"change",this.render),this.listenTo(this.collection,"add remove change",this.render),this.render()},tpl:function(){var e=this;return D("div",{className:"threshold-editor",id:"threshold-editor-"+this.cid},[D("div",{className:"threshold-editor__body"},[D("div",{className:"threshold-editor__row threshold-editor__header"},[D("div",{className:"threshold-editor__col-1"},["From",D("span",{className:"threshold-editor__split"})]),D("div",{className:"threshold-editor__col-1"},["Until",D("span",{className:"threshold-editor__split"})]),D("div",{className:"threshold-editor__col-5"},["Comparison",D("span",{className:"threshold-editor__split"})]),D("div",{className:"threshold-editor__col-3"},["Alerts"])]),D("div",{className:"threshold-editor__row threshold-editor__control"},[D("div",{className:"threshold-editor__col-10"},[D("a",{href:"javascript:;",className:"threshold-editor__button threshold-editor__button--add",onclick:function(){return e.addNewItem()}},["add a new threshold (+)"])])]),D("div",{className:"threshold-editor__content"},[this.collection.sortBy(function(e){var t=e.getFrom();return t=""===t?24:~~t}).map(function(t,n){return it(Object.assign({},{state:{index:n,selected:t.get("editing")},parentState:e,model:t,components:e.components,instanceName:"component-editor-row"+t.cid}))})])]),st(Object.assign({},{parentState:this,collection:this.collection,components:this.components,instanceName:"component-time-line"+this.cid})),D("div",{className:"threshold-editor__button-group"},[D("a",{href:"javascript:;",onclick:function(){return e.export()}},["save"])])])},itemClick:function(e){at=!0,e.set("editing",!0),this.collection.filter(function(t){return t.cid!==e.cid}).forEach(function(e){return e.set("editing",!1)})},addNewItem:function(){this.collection.add(new $e)},removeItem:function(e,t){at=!0,this.collection.remove(e),t<this.collection.length&&this.collection.models[t].set("editing",!0)},fromChange:function(e,t,n){""===n?e.set({from:"",to:""}):e.set(""===t?{from:n+":00",to:"00:00"}:{from:n+":00"})},toChange:function(e,t){e.set("to",""===t?"":t+":00")},thresholdChange:function(e,t,n){switch(t){case 0:e.setFirst(n);break;case 1:e.setSecond(n);break;case 2:e.setThree(n)}},export:function(){this.trigger("save",this.collection.export())}});var ut=e.Collection.extend({model:$e,comparator:function(e,t){var n=e.getFrom(),r=t.getFrom();return(n=""===n?24:~~n)>(r=""===r?24:~~r)?1:0},export:function(){var e=[];return this.sortBy(function(e){var t=e.getFrom();return t=""===t?24:~~t}).forEach(function(t){var n=t.get("from"),r=t.get("to"),o=[t.get("operator"),t.get("threshold").replace(/\s+$/g,"")];o=(""!==r&&""!==n?["(",n,r,")"]:[""]).concat(o),e.push(o.join(" "))}),console.log(e),e.join(",").replace(/\(\s/g,"(").replace(/\s\)/g,")").replace(/\s{2,}/g," ").replace(/\s,/g,",")}});return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(lt,[null].concat(t)))}({el:e,collection:new ut(t.chain(n.split(",")).compact().map(function(e){return Ke(e)}).value())})}});
